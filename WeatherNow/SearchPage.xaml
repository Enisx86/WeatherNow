<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:WeatherNow.ViewModels"
             xmlns:models="clr-namespace:WeatherNow.Models"
             xmlns:Controls="clr-namespace:WeatherNow.Controls"
             x:DataType="vm:SearchPageViewModel"
             x:Class="WeatherNow.SearchPage"
             Title="SearchPage">
    <ContentPage.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#E3F2FD" Offset="0.0" />
            <GradientStop Color="#90CAF9" Offset="1.0" />
        </LinearGradientBrush>
    </ContentPage.Background>

    <!-- 
        i have no idea why the floating navbar still works, it's honestly black magic
        don't mess up the layouts though, bcuz .NET MAUI loves trolling and i can't figure this out again
        -Anelko
    -->
    <Grid>
        <ScrollView>
            <VerticalStackLayout>
                <!-- Search bar -->
                    <Grid ColumnDefinitions="2*,*" Margin="10" ColumnSpacing="10">
                        <Border
                            Grid.Column="0"
                            Stroke="#C7DEF5"
                            StrokeThickness="1"
                            BackgroundColor="#F4F9FF"
                            Padding="15,10"
                            StrokeShape="RoundRectangle 16">

                        <Entry Text="{Binding SearchBarText, Mode=TwoWay}" Placeholder="Search here..." ReturnCommand="{Binding SearchCommand}" BackgroundColor="Transparent" />
                    </Border>
                        
                    <!-- Search button -->
                    <Button
                        Grid.Column="1"
                        Text="Search"
                        Command="{Binding SearchCommand}"
                        BackgroundColor="#C7DEF5"
                        TextColor="#222"
                        CornerRadius="16" />

                        <!-- Ono ostalo ispod haha-->
                </Grid>
                <ActivityIndicator IsRunning="{Binding IsSearching}" IsVisible="{Binding IsSearching}" />
                <VerticalStackLayout Padding="0,0,0,128" Spacing="24" BindableLayout.ItemsSource="{Binding AvailableCities}">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:CityItem">
                            <Grid ColumnDefinitions="*,8*,*">
                                <Border
                                    Grid.Column="1"
                                    Stroke="#C7DEF5"
                                    StrokeThickness="1"
                                    StrokeShape="RoundRectangle 20"
                                    BackgroundColor="#F4F9FF"
                                    Padding="20">
                                    <Border.Shadow>
                                        <Shadow Brush="Black" Offset="1,2" Opacity="0.12" />
                                    </Border.Shadow>

                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnCardTapped" />
                                    </Border.GestureRecognizers>
                                    
                                    <Grid ColumnDefinitions="*,Auto">
                                        <VerticalStackLayout Grid.Column="0">
                                            <Label Text="{Binding City.name}" FontSize="20" TextColor="#222" FontAttributes="Bold" />
                                            <Label Text="{Binding City.country}" FontSize="14" TextColor="#666" />
                                            <Label Text="{Binding City.CountryEmoji}" FontSize="24" Margin="0,0,0,10" />

                                            <ImageButton Source="favorite.png" Clicked="Favorite_Clicked" MaximumHeightRequest="24" HorizontalOptions="Start" Margin="-12,0">
                                                <ImageButton.Style>
                                                    <Style TargetType="ImageButton">
                                                        <Setter Property="Source" Value="favorite.png" />
                                                        <Style.Triggers>
                                                            <DataTrigger TargetType="ImageButton" Binding="{Binding Favorite}" Value="True">
                                                                <Setter Property="Source" Value="favorite_fill.png" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ImageButton.Style>
                                            </ImageButton>
                                        </VerticalStackLayout>
                                        <Label Grid.Column="1" Text="âŸ©" TextColor="#666" FontSize="20" VerticalOptions="Center" />
                                    </Grid>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>
        <Controls:FloatingNavbar ActiveTab="Search" />
    </Grid>
</ContentPage>